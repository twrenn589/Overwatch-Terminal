<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Overwatch Terminal</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&family=DM+Sans:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg-primary: #080b12;
  --bg-secondary: #0e1420;
  --bg-card: #131b2b;
  --bg-card-hover: #182035;
  --border: #1e2d48;
  --border-bright: #2a3f65;
  --text-primary: #dfe6f0;
  --text-secondary: #7d8faa;
  --text-muted: #44556e;
  --accent-green: #00e599;
  --accent-green-dim: #00e59920;
  --accent-green-glow: #00e59940;
  --accent-red: #ff4757;
  --accent-red-dim: #ff475720;
  --accent-amber: #ffa726;
  --accent-amber-dim: #ffa72620;
  --accent-blue: #4dabf7;
  --accent-blue-dim: #4dabf720;
  --accent-purple: #b197fc;
  --accent-purple-dim: #b197fc20;
  --accent-cyan: #00c8c8;
  --accent-cyan-dim: #00c8c815;
  --accent-cyan-glow: #00c8c830;
  --radius: 10px;
  --radius-sm: 6px;
}

* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body {
  font-family: 'DM Sans', -apple-system, sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  min-height: 100vh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

/* ===== HEADER ===== */
.header {
  position: sticky;
  top: 0;
  z-index: 100;
  background: rgba(8, 11, 18, 0.95);
  backdrop-filter: blur(24px);
  -webkit-backdrop-filter: blur(24px);
  border-bottom: 1px solid var(--border);
  padding: 10px 14px;
}

.header-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.logo {
  display: flex;
  align-items: center;
  gap: 8px;
}

.logo-icon {
  width: 28px;
  height: 28px;
  border: 2px solid var(--accent-cyan);
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  background: var(--accent-cyan-dim);
  box-shadow: 0 0 12px var(--accent-cyan-dim);
}

.logo-text {
  font-family: 'JetBrains Mono', monospace;
  font-weight: 700;
  font-size: 15px;
  letter-spacing: 3px;
  color: var(--text-primary);
}

.logo-text .sub {
  display: block;
  font-size: 8px;
  font-weight: 400;
  letter-spacing: 4px;
  color: var(--accent-cyan);
  margin-top: -2px;
}

.header-controls {
  display: flex;
  align-items: center;
  gap: 8px;
}

.refresh-btn {
  background: none;
  border: 1px solid var(--border);
  color: var(--text-muted);
  padding: 5px 10px;
  border-radius: var(--radius-sm);
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  cursor: pointer;
  transition: all 0.2s;
}

.refresh-btn:hover, .refresh-btn:active {
  border-color: var(--accent-cyan);
  color: var(--accent-cyan);
}

.last-updated {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  color: var(--text-muted);
}

/* Ticker Strip */
.ticker-strip {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 10px;
  background: var(--bg-secondary);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
}

.ticker-price {
  font-family: 'JetBrains Mono', monospace;
  font-size: 22px;
  font-weight: 700;
  letter-spacing: -0.5px;
}

.ticker-pair {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  color: var(--text-muted);
  letter-spacing: 1px;
}

.ticker-change {
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  padding: 2px 8px;
  border-radius: 4px;
  font-weight: 600;
}

.ticker-change.positive { color: var(--accent-green); background: var(--accent-green-dim); }
.ticker-change.negative { color: var(--accent-red); background: var(--accent-red-dim); }

.ticker-meta {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  color: var(--text-muted);
  margin-left: auto;
  text-align: right;
  line-height: 1.5;
}

/* ===== TAB NAV ===== */
.tab-nav {
  display: flex;
  gap: 2px;
  padding: 6px 10px;
  background: var(--bg-primary);
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
  border-bottom: 1px solid var(--border);
  position: sticky;
  top: 92px;
  z-index: 99;
}

.tab-nav::-webkit-scrollbar { display: none; }

.tab-btn {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  font-weight: 500;
  padding: 7px 12px;
  border: 1px solid transparent;
  border-radius: 4px;
  background: transparent;
  color: var(--text-muted);
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.15s;
  letter-spacing: 0.5px;
}

.tab-btn:hover, .tab-btn:active { color: var(--text-secondary); }

.tab-btn.active {
  background: var(--accent-cyan-dim);
  color: var(--accent-cyan);
  border-color: rgba(0, 200, 200, 0.3);
}

/* ===== CONTENT ===== */
.content { padding: 12px; }
.tab-panel { display: none; }
.tab-panel.active { display: block; }

/* ===== CARDS ===== */
.summary-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin-bottom: 12px;
}

.summary-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 12px;
  position: relative;
  overflow: hidden;
}

.summary-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2px;
}

.summary-card.green::before { background: var(--accent-green); }
.summary-card.red::before { background: var(--accent-red); }
.summary-card.amber::before { background: var(--accent-amber); }
.summary-card.blue::before { background: var(--accent-blue); }
.summary-card.purple::before { background: var(--accent-purple); }
.summary-card.cyan::before { background: var(--accent-cyan); }

.card-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  font-weight: 500;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 4px;
}

.card-value {
  font-family: 'JetBrains Mono', monospace;
  font-size: 17px;
  font-weight: 700;
  margin-bottom: 2px;
}

.card-sub {
  font-size: 11px;
  color: var(--text-secondary);
}

.card-status {
  display: inline-block;
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  font-weight: 600;
  padding: 2px 7px;
  border-radius: 3px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-top: 4px;
}

.status-bullish { color: var(--accent-green); background: var(--accent-green-dim); }
.status-bearish { color: var(--accent-red); background: var(--accent-red-dim); }
.status-neutral { color: var(--accent-amber); background: var(--accent-amber-dim); }
.status-watch { color: var(--accent-blue); background: var(--accent-blue-dim); }

/* Full-width card */
.full-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 14px;
  margin-bottom: 10px;
}

.full-card h3 {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  font-weight: 600;
  color: var(--accent-cyan);
  margin-bottom: 10px;
  text-transform: uppercase;
  letter-spacing: 1.5px;
}

/* Data Rows */
.data-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 7px 0;
  border-bottom: 1px solid rgba(30, 45, 72, 0.5);
}
.data-row:last-child { border-bottom: none; }

.data-label { font-size: 12px; color: var(--text-secondary); }

.data-value {
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  font-weight: 500;
}

.data-value.green { color: var(--accent-green); }
.data-value.red { color: var(--accent-red); }
.data-value.amber { color: var(--accent-amber); }
.data-value.blue { color: var(--accent-blue); }

/* Interpretation Box */
.interpret-box {
  background: rgba(0, 200, 200, 0.04);
  border: 1px solid rgba(0, 200, 200, 0.15);
  border-left: 3px solid var(--accent-cyan);
  border-radius: var(--radius-sm);
  padding: 10px 12px;
  margin-top: 10px;
}

.interpret-box .label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  font-weight: 600;
  color: var(--accent-cyan);
  text-transform: uppercase;
  letter-spacing: 1.5px;
  margin-bottom: 5px;
}

.interpret-box p {
  font-size: 12px;
  color: var(--text-secondary);
  line-height: 1.55;
}

.interpret-box p strong { color: var(--text-primary); }

/* Thesis Items */
.thesis-item {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 10px 0;
  border-bottom: 1px solid rgba(30, 45, 72, 0.5);
}
.thesis-item:last-child { border-bottom: none; }

.thesis-indicator {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  margin-top: 4px;
  flex-shrink: 0;
}

.thesis-indicator.green { background: var(--accent-green); box-shadow: 0 0 8px var(--accent-green-glow); }
.thesis-indicator.red { background: var(--accent-red); box-shadow: 0 0 8px var(--accent-red-dim); }
.thesis-indicator.amber { background: var(--accent-amber); box-shadow: 0 0 8px var(--accent-amber-dim); }

.thesis-text h4 { font-size: 12px; font-weight: 600; margin-bottom: 2px; }
.thesis-text p { font-size: 11px; color: var(--text-secondary); line-height: 1.45; }

/* Amendment Items */
.amendment-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 0;
  border-bottom: 1px solid rgba(30, 45, 72, 0.5);
}
.amendment-item:last-child { border-bottom: none; }

.amend-status {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  font-weight: 600;
  padding: 2px 7px;
  border-radius: 3px;
  white-space: nowrap;
}

.amend-live { background: var(--accent-green-dim); color: var(--accent-green); }
.amend-voting { background: var(--accent-amber-dim); color: var(--accent-amber); }
.amend-soon { background: var(--accent-blue-dim); color: var(--accent-blue); }

.amend-name { font-size: 12px; font-weight: 500; flex: 1; }
.amend-detail { font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--text-muted); }

/* Quick Links */
.quick-links {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 6px;
  margin-top: 10px;
}

.quick-link {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px;
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--text-secondary);
  text-decoration: none;
  font-size: 11px;
  font-weight: 500;
  transition: all 0.15s;
}

.quick-link:hover, .quick-link:active {
  border-color: var(--accent-cyan);
  color: var(--accent-cyan);
}

.quick-link .link-icon { font-size: 14px; flex-shrink: 0; }

/* Section Header */
.section-header {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 2px;
  margin: 18px 0 8px;
  padding-bottom: 5px;
  border-bottom: 1px solid var(--border);
}

/* Countdown */
.countdown {
  font-family: 'JetBrains Mono', monospace;
  text-align: center;
  padding: 14px;
  background: linear-gradient(135deg, rgba(0, 200, 200, 0.06), rgba(77, 171, 247, 0.04));
  border: 1px solid rgba(0, 200, 200, 0.15);
  border-radius: var(--radius);
  margin-bottom: 12px;
}

.countdown-label {
  font-size: 9px;
  font-weight: 500;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 2px;
  margin-bottom: 4px;
}

.countdown-value {
  font-size: 26px;
  font-weight: 700;
  color: var(--accent-cyan);
  text-shadow: 0 0 20px var(--accent-cyan-dim);
}

.countdown-sub {
  font-size: 10px;
  color: var(--text-secondary);
  margin-top: 2px;
}

/* Live dot pulse */
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}

.live-dot {
  display: inline-block;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--accent-green);
  animation: pulse 2s infinite;
  margin-right: 4px;
}

/* Loading shimmer */
@keyframes shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* ===== X FEED TAB ===== */
.feed-category {
  margin-bottom: 16px;
}

.feed-category-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  font-weight: 600;
  color: var(--accent-purple);
  text-transform: uppercase;
  letter-spacing: 2px;
  margin-bottom: 8px;
  padding-bottom: 4px;
  border-bottom: 1px solid rgba(177, 151, 252, 0.15);
}

.feed-accounts {
  display: grid;
  grid-template-columns: 1fr;
  gap: 6px;
}

.feed-account-card {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 12px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  text-decoration: none;
  color: var(--text-primary);
  transition: all 0.15s;
}

.feed-account-card:hover, .feed-account-card:active {
  border-color: var(--accent-cyan);
  background: var(--bg-card-hover);
}

.feed-avatar {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  flex-shrink: 0;
}

.feed-account-info {
  flex: 1;
  min-width: 0;
}

.feed-handle {
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  font-weight: 600;
  color: var(--text-primary);
}

.feed-desc {
  font-size: 10px;
  color: var(--text-muted);
  margin-top: 1px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.feed-tag {
  font-family: 'JetBrains Mono', monospace;
  font-size: 8px;
  font-weight: 600;
  padding: 2px 6px;
  border-radius: 3px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  flex-shrink: 0;
}

.feed-tag.policy { background: rgba(255, 167, 38, 0.15); color: var(--accent-amber); }
.feed-tag.infra { background: rgba(0, 200, 200, 0.15); color: var(--accent-cyan); }
.feed-tag.macro { background: rgba(177, 151, 252, 0.15); color: var(--accent-purple); }
.feed-tag.news { background: rgba(77, 171, 247, 0.15); color: var(--accent-blue); }

/* ===== ODL GUIDE TAB ===== */
.guide-step {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 14px;
  margin-bottom: 10px;
}

.guide-step-num {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  font-weight: 700;
  color: var(--accent-cyan);
  text-transform: uppercase;
  letter-spacing: 2px;
  margin-bottom: 6px;
}

.guide-step h4 {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 8px;
}

.guide-step p {
  font-size: 12px;
  color: var(--text-secondary);
  line-height: 1.55;
  margin-bottom: 8px;
}

.guide-step p:last-child { margin-bottom: 0; }

.guide-callout {
  background: rgba(0, 229, 153, 0.06);
  border: 1px solid rgba(0, 229, 153, 0.15);
  border-left: 3px solid var(--accent-green);
  border-radius: var(--radius-sm);
  padding: 10px 12px;
  margin: 8px 0;
}

.guide-callout p {
  font-size: 11px;
  color: var(--accent-green);
  line-height: 1.5;
}

.guide-warning {
  background: rgba(255, 71, 87, 0.06);
  border: 1px solid rgba(255, 71, 87, 0.15);
  border-left: 3px solid var(--accent-red);
  border-radius: var(--radius-sm);
  padding: 10px 12px;
  margin: 8px 0;
}

.guide-warning p {
  font-size: 11px;
  color: var(--accent-red);
  line-height: 1.5;
}

.guide-metric {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 10px;
  background: var(--bg-secondary);
  border-radius: var(--radius-sm);
  margin: 4px 0;
}

.guide-metric .gm-label { font-size: 11px; color: var(--text-secondary); }
.guide-metric .gm-value { font-family: 'JetBrains Mono', monospace; font-size: 11px; font-weight: 600; }
.guide-metric .gm-value.green { color: var(--accent-green); }
.guide-metric .gm-value.amber { color: var(--accent-amber); }
.guide-metric .gm-value.red { color: var(--accent-red); }

/* ===== MOBILE ===== */
@media (max-width: 480px) {
  .summary-grid { gap: 6px; }
  .card-value { font-size: 15px; }
  .ticker-price { font-size: 20px; }
  .ticker-meta { display: none; }
  .content { padding: 10px; }
}

@media (min-width: 768px) {
  .summary-grid { grid-template-columns: repeat(3, 1fr); }
  .content { max-width: 900px; margin: 0 auto; padding: 20px; }
  .feed-accounts { grid-template-columns: 1fr 1fr; }
  .ticker-meta { display: block; }
}

/* ===== POSITION CALCULATOR (Bottom Dock) ===== */
.position-dock {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(8, 11, 18, 0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-top: 1px solid var(--border);
  padding: 8px 14px;
  z-index: 100;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.position-dock .pos-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  color: var(--text-muted);
  letter-spacing: 1px;
}

.position-dock .pos-value {
  font-family: 'JetBrains Mono', monospace;
  font-size: 16px;
  font-weight: 700;
  color: var(--accent-green);
}

.position-dock .pos-xrp {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  color: var(--text-muted);
}

/* Add bottom padding to content to prevent dock overlap */
.content { padding-bottom: 60px; }
</style>
</head>
<body>

<!-- ===== HEADER ===== -->
<div class="header">
  <div class="header-top">
    <div class="logo">
      <div class="logo-icon">‚óâ</div>
      <div class="logo-text">
        OVERWATCH
        <span class="sub">TERMINAL</span>
      </div>
    </div>
    <div class="header-controls">
      <button class="refresh-btn" onclick="refreshAll()">‚Üª REFRESH</button>
      <div class="last-updated" id="lastUpdated"><span class="live-dot"></span>LIVE</div>
    </div>
  </div>
  <div class="ticker-strip">
    <div>
      <div class="ticker-pair">XRP / USD</div>
      <div class="ticker-price" id="xrpPrice">--</div>
    </div>
    <div class="ticker-change" id="xrpChange">--</div>
    <div class="ticker-meta" id="xrpMeta">
      <div>Vol: <span id="xrpVol">--</span></div>
      <div>MCap: <span id="xrpMcap">--</span></div>
    </div>
  </div>
</div>

<!-- ===== TAB NAV ===== -->
<div class="tab-nav">
  <button class="tab-btn active" data-tab="summary">OVERVIEW</button>
  <button class="tab-btn" data-tab="briefing">‚óâ BRIEF</button>
  <button class="tab-btn" data-tab="odl">ODL</button>
  <button class="tab-btn" data-tab="etf">ETF</button>
  <button class="tab-btn" data-tab="macro">MACRO</button>
  <button class="tab-btn" data-tab="infra">XRPL</button>
  <button class="tab-btn" data-tab="thesis">SCORE</button>
  <button class="tab-btn" data-tab="feed">INTEL</button>
  <button class="tab-btn" data-tab="odlguide">ODL GUIDE</button>
  <button class="tab-btn" data-tab="links">LINKS</button>
</div>

<!-- ===== CONTENT ===== -->
<div class="content">

  <!-- ==================== SUMMARY ==================== -->
  <div class="tab-panel active" id="panel-summary">
    <div class="countdown">
      <div class="countdown-label">PermissionedDEX Activation</div>
      <div class="countdown-value" id="pdexCountdown">--d --h --m</div>
      <div class="countdown-sub">Target: Feb 17-20, 2026</div>
    </div>

    <div class="summary-grid">
      <div class="summary-card cyan">
        <div class="card-label">ODL Activity</div>
        <div class="card-value" id="odlStatus">$15B+</div>
        <div class="card-sub">2024 annual | 70+ corridors</div>
      </div>
      <div class="summary-card green">
        <div class="card-label">ETF Flow</div>
        <div class="card-value" id="etfFlow">+$1.37B</div>
        <div class="card-sub">Cumulative inflows</div>
        <span class="card-status status-bullish">55-DAY STREAK</span>
      </div>
      <div class="summary-card purple">
        <div class="card-label">ETFs Active</div>
        <div class="card-value">7 US Spot</div>
        <div class="card-sub">~780M XRP locked</div>
      </div>
      <div class="summary-card amber">
        <div class="card-label">USD / JPY</div>
        <div class="card-value" id="usdJpy">--</div>
        <div class="card-sub">Carry trade watch</div>
      </div>
      <div class="summary-card red">
        <div class="card-label">Oil (WTI)</div>
        <div class="card-value" id="oilPrice">--</div>
        <div class="card-sub">Hormuz indicator</div>
      </div>
      <div class="summary-card blue">
        <div class="card-label">JPN 10Y</div>
        <div class="card-value">2.25%</div>
        <div class="card-sub">Near record highs</div>
        <span class="card-status status-watch">ELEVATED</span>
      </div>
    </div>

    <!-- Live Chain Status Mini -->
    <div class="full-card" style="margin-bottom:12px;">
      <h3>‚õì Live XRPL</h3>
      <div class="data-row">
        <span class="data-label">Ledger</span>
        <span class="data-value blue" id="summaryLedger">--</span>
      </div>
      <div class="data-row">
        <span class="data-label">Last Ledger Txns</span>
        <span class="data-value" id="summaryTxns">--</span>
      </div>
      <div class="data-row">
        <span class="data-label">XRP Burned (Total)</span>
        <span class="data-value amber" id="summaryBurned">--</span>
      </div>
    </div>

    <div class="full-card">
      <h3>‚ö° Thesis Pulse</h3>
      <div class="thesis-item">
        <div class="thesis-indicator green"></div>
        <div class="thesis-text">
          <h4>Infrastructure Deployment</h4>
          <p>PermissionedDEX activating ~Feb 17-20. Permissioned Domains live. RLUSD on Binance. DXC/Hogan integration announced. Ripple Prime + Hyperliquid live.</p>
        </div>
      </div>
      <div class="thesis-item">
        <div class="thesis-indicator green"></div>
        <div class="thesis-text">
          <h4>Institutional Positioning</h4>
          <p>XRP ETFs: only crypto ETF with inflows during crash. 7 US spot ETFs, ~780M XRP locked. Japan FIEA reclassification targeting Q2 2026.</p>
        </div>
      </div>
      <div class="thesis-item">
        <div class="thesis-indicator amber"></div>
        <div class="thesis-text">
          <h4>Regulatory Clarity</h4>
          <p>EU EMI license granted. UK FCA approved. Singapore MPI expanded. US Clarity Act pushed to Spring. SEC/CFTC proceeding independently.</p>
        </div>
      </div>
      <div class="thesis-item">
        <div class="thesis-indicator red"></div>
        <div class="thesis-text">
          <h4>Market Conditions</h4>
          <p>Crypto fear index at 11. Full capitulation mode. BUT: XRP ETF flows diverging bullish from BTC/ETH. Gap between price and infrastructure reality is the thesis edge.</p>
        </div>
      </div>
      <div class="thesis-item">
        <div class="thesis-indicator amber"></div>
        <div class="thesis-text">
          <h4>Geopolitical Catalyst</h4>
          <p>US-Iran talks in Oman. Carrier deployed. Diplomacy and escalation simultaneous. Japan snap election Feb 8 ‚Äî fiscal expansion + bond volatility.</p>
        </div>
      </div>
    </div>

    <div class="interpret-box">
      <div class="label">Overwatch Assessment</div>
      <p><strong>Infrastructure deploying on schedule.</strong> Institutional money accumulating XRP while exiting BTC/ETH. Price in capitulation ‚Äî adoption metrics diverging bullish. Key watch: post-PermissionedDEX ODL volume and pDEX activity starting ~Feb 20.</p>
    </div>
  </div>

  <!-- ==================== BRIEFING ==================== -->
  <div class="tab-panel" id="panel-briefing">
    <div class="full-card" style="border-color: rgba(0,200,200,0.3);">
      <h3>‚óâ Daily Intelligence Briefing</h3>
      <div id="briefingContent" style="font-size:13px;color:var(--text-secondary);line-height:1.6;">
        <p style="color:var(--text-muted);font-style:italic;">Loading latest briefing from Telegram...</p>
      </div>
      <div style="margin-top:12px;padding-top:10px;border-top:1px solid var(--border);">
        <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--text-muted);letter-spacing:1px;">LAST UPDATED: <span id="briefingTime">--</span></div>
      </div>
    </div>

    <div class="full-card">
      <h3>üì° Manual Briefing Input</h3>
      <p style="font-size:11px;color:var(--text-muted);margin-bottom:8px;">Paste your Telegram briefing here if auto-load doesn't work:</p>
      <textarea id="briefingInput" style="width:100%;min-height:120px;background:var(--bg-secondary);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text-primary);font-family:'DM Sans',sans-serif;font-size:12px;padding:10px;resize:vertical;outline:none;" placeholder="Paste your morning briefing here..."></textarea>
      <button onclick="loadManualBriefing()" style="margin-top:8px;padding:8px 16px;background:var(--accent-cyan-dim);border:1px solid rgba(0,200,200,0.3);color:var(--accent-cyan);font-family:'JetBrains Mono',monospace;font-size:11px;border-radius:var(--radius-sm);cursor:pointer;">LOAD BRIEFING</button>
    </div>

    <div class="full-card">
      <h3>‚õì Live Chain Status</h3>
      <div class="data-row">
        <span class="data-label">XRPL Connection</span>
        <span class="data-value" id="wsStatus"><span class="live-dot"></span>Connecting...</span>
      </div>
      <div class="data-row">
        <span class="data-label">Latest Ledger</span>
        <span class="data-value blue" id="latestLedger">--</span>
      </div>
      <div class="data-row">
        <span class="data-label">Ledger Close Time</span>
        <span class="data-value" id="ledgerTime">--</span>
      </div>
      <div class="data-row">
        <span class="data-label">Txns in Last Ledger</span>
        <span class="data-value" id="ledgerTxns">--</span>
      </div>
      <div class="data-row">
        <span class="data-label">Base Fee</span>
        <span class="data-value" id="baseFee">--</span>
      </div>
      <div class="data-row">
        <span class="data-label">Total XRP Supply</span>
        <span class="data-value" id="totalXrp">--</span>
      </div>
      <div class="data-row">
        <span class="data-label">XRP Destroyed</span>
        <span class="data-value amber" id="xrpDestroyed">--</span>
      </div>
      <div class="data-row">
        <span class="data-label">Validated Ledgers</span>
        <span class="data-value" id="validatedRange">--</span>
      </div>
      <div class="interpret-box">
        <div class="label">Live On-Chain</div>
        <p>This data comes directly from the XRPL via WebSocket ‚Äî not a third party. You're reading the ledger itself. Ledger close time ~3-5 seconds. Rising txn counts = growing network usage.</p>
      </div>
    </div>
  </div>

  <!-- ==================== ODL & ON-CHAIN ==================== -->
  <div class="tab-panel" id="panel-odl">
    <div class="full-card">
      <h3>On-Demand Liquidity</h3>
      <div class="data-row">
        <span class="data-label">2024 Annual ODL Volume</span>
        <span class="data-value green">$15B+</span>
      </div>
      <div class="data-row">
        <span class="data-label">YoY Growth</span>
        <span class="data-value green">+32%</span>
      </div>
      <div class="data-row">
        <span class="data-label">Active Corridors</span>
        <span class="data-value">70+</span>
      </div>
      <div class="data-row">
        <span class="data-label">RippleNet Institutions</span>
        <span class="data-value">300+</span>
      </div>
      <div class="data-row">
        <span class="data-label">% Using ODL (XRP)</span>
        <span class="data-value blue">~40%</span>
      </div>
      <div class="data-row">
        <span class="data-label">APAC Share of Volume</span>
        <span class="data-value">~56%</span>
      </div>
      <div class="interpret-box">
        <div class="label">Falsification Criterion</div>
        <p>If geopolitical stress increases but ODL volume doesn't spike, the thesis weakens. <strong>$15B in 2024 needs to trend toward $20-30B+ in 2026 for base case validation.</strong> Track post-PermissionedDEX activation carefully.</p>
      </div>
    </div>

    <div class="full-card">
      <h3>XRPL On-Chain</h3>
      <div class="data-row">
        <span class="data-label">Daily Transactions</span>
        <span class="data-value">~1.8M</span>
      </div>
      <div class="data-row">
        <span class="data-label">Active Addresses</span>
        <span class="data-value">~6.9M</span>
      </div>
      <div class="data-row">
        <span class="data-label">XRPL DEX Daily Volume</span>
        <span class="data-value">~$7.9M (CLOB)</span>
      </div>
      <div class="data-row">
        <span class="data-label">XRPL AMM Volume</span>
        <span class="data-value">~$1.7M</span>
      </div>
      <div class="data-row">
        <span class="data-label">XRP Burned (All-Time)</span>
        <span class="data-value amber">~13M XRP</span>
      </div>
      <div class="data-row">
        <span class="data-label">Escrow Remaining</span>
        <span class="data-value">~35-38B XRP</span>
      </div>
      <div class="interpret-box">
        <div class="label">Reading This Data</div>
        <p><strong>DEX volume is still small</strong> ‚Äî expected pre-PermissionedDEX. Once pDEX goes live with KYC-gated institutional trading, watch for a jump. If it stays flat post-activation, that's a concern. Rising daily txns + declining exchange supply = accumulation.</p>
      </div>
    </div>
  </div>

  <!-- ==================== ETF ==================== -->
  <div class="tab-panel" id="panel-etf">
    <div class="full-card">
      <h3>XRP Spot ETFs (US)</h3>
      <div class="data-row">
        <span class="data-label">Total ETFs</span>
        <span class="data-value">7</span>
      </div>
      <div class="data-row">
        <span class="data-label">Combined AUM</span>
        <span class="data-value green">~$970M</span>
      </div>
      <div class="data-row">
        <span class="data-label">XRP Locked in ETFs</span>
        <span class="data-value blue">~780M XRP</span>
      </div>
      <div class="data-row">
        <span class="data-label">Cumulative Inflows</span>
        <span class="data-value green">$1.37B+</span>
      </div>
      <div class="data-row">
        <span class="data-label">Consecutive Inflow Streak</span>
        <span class="data-value green">55 days (record)</span>
      </div>

      <div class="section-header" style="margin-top:12px;">Crash Comparison ‚Äî Feb 5</div>
      <div class="data-row">
        <span class="data-label">BTC ETF Flow</span>
        <span class="data-value red">-$545M</span>
      </div>
      <div class="data-row">
        <span class="data-label">ETH ETF Flow</span>
        <span class="data-value red">-$79M</span>
      </div>
      <div class="data-row">
        <span class="data-label">XRP ETF Flow</span>
        <span class="data-value green">+$4.83M ‚úì</span>
      </div>

      <div class="interpret-box">
        <div class="label">Signal Reading</div>
        <p><strong>XRP was the ONLY crypto ETF with inflows during the crash.</strong> Direction matters more than magnitude. Institutions accumulating XRP while dumping BTC/ETH. This is structural positioning, not speculation. Watch for magnitude to scale post-pDEX.</p>
      </div>
    </div>

    <div class="full-card">
      <h3>ETF Issuers</h3>
      <div class="data-row">
        <span class="data-label">Canary Capital (XRPC)</span>
        <span class="data-value">Largest holder</span>
      </div>
      <div class="data-row">
        <span class="data-label">Bitwise (XRP)</span>
        <span class="data-value">Major holder</span>
      </div>
      <div class="data-row">
        <span class="data-label">Franklin Templeton (XRPZ)</span>
        <span class="data-value">Active inflows</span>
      </div>
      <div class="data-row">
        <span class="data-label">Grayscale (GXRP)</span>
        <span class="data-value amber">Mixed flows</span>
      </div>
      <div class="data-row">
        <span class="data-label">21Shares (TOXR)</span>
        <span class="data-value">Active</span>
      </div>
    </div>
  </div>

  <!-- ==================== MACRO ==================== -->
  <div class="tab-panel" id="panel-macro">
    <div class="full-card">
      <h3>Macro Indicators</h3>
      <div class="data-row">
        <span class="data-label">USD / JPY</span>
        <span class="data-value amber" id="macroJpy">--</span>
      </div>
      <div class="data-row">
        <span class="data-label">Japan 10Y JGB Yield</span>
        <span class="data-value red">2.25% (near record)</span>
      </div>
      <div class="data-row">
        <span class="data-label">Japan 40Y JGB Yield</span>
        <span class="data-value red">4%+ (all-time high)</span>
      </div>
      <div class="data-row">
        <span class="data-label">Crude Oil (WTI)</span>
        <span class="data-value" id="macroOil">--</span>
      </div>
      <div class="data-row">
        <span class="data-label">Gold</span>
        <span class="data-value green">~$4,850</span>
      </div>
      <div class="data-row">
        <span class="data-label">Silver</span>
        <span class="data-value red">~$117 (crashed 15%)</span>
      </div>
      <div class="data-row">
        <span class="data-label">DXY (Dollar Index)</span>
        <span class="data-value">97.5+</span>
      </div>
      <div class="data-row">
        <span class="data-label">Crypto Fear & Greed</span>
        <span class="data-value red">11 (Extreme Fear)</span>
      </div>

      <div class="interpret-box">
        <div class="label">Carry Trade Status</div>
        <p><strong>ACTIVE UNWINDING.</strong> Japan 40Y yields hit all-time highs. PM Takaichi's fiscal expansion + snap election (Feb 8) causing bond volatility. Carry trade reversal forcing synchronized selling across global assets. Watch: If yen strengthens sharply post-election, carry unwind accelerates.</p>
      </div>
    </div>

    <div class="full-card">
      <h3>üî¥ Geopolitical: Iran / Hormuz</h3>
      <div class="data-row">
        <span class="data-label">Status</span>
        <span class="data-value amber">TALKS FRIDAY (Oman)</span>
      </div>
      <div class="data-row">
        <span class="data-label">US-Iran Talks</span>
        <span class="data-value">Witkoff + Kushner ‚Üí Oman</span>
      </div>
      <div class="data-row">
        <span class="data-label">Iran Posture</span>
        <span class="data-value amber">Diplomacy + deterrence</span>
      </div>
      <div class="data-row">
        <span class="data-label">US Carrier Strike Group</span>
        <span class="data-value red">Deployed (Arabian Sea)</span>
      </div>
      <div class="data-row">
        <span class="data-label">Hormuz Incidents</span>
        <span class="data-value red">Drone shot down + tanker threat</span>
      </div>

      <div class="interpret-box">
        <div class="label">Assessment</div>
        <p>Simultaneous escalation and diplomacy ‚Äî classic brinksmanship. If talks fail ‚Üí oil spike ‚Üí Hormuz catalyst goes live. If talks succeed ‚Üí infrastructure thesis unaffected. <strong>Oil price is the leading indicator.</strong></p>
      </div>
    </div>

    <div class="full-card">
      <h3>üáØüáµ Japan Watch</h3>
      <div class="data-row">
        <span class="data-label">Snap Election</span>
        <span class="data-value amber">Feb 8, 2026</span>
      </div>
      <div class="data-row">
        <span class="data-label">PM Takaichi Fiscal Plans</span>
        <span class="data-value red">Consumption tax suspension</span>
      </div>
      <div class="data-row">
        <span class="data-label">Bond Market</span>
        <span class="data-value red">"Chaotic" ‚Äî Truss comparisons</span>
      </div>
      <div class="data-row">
        <span class="data-label">FIEA XRP Reclassification</span>
        <span class="data-value blue">Targeting Q2 2026</span>
      </div>
      <div class="data-row">
        <span class="data-label">Crypto Tax Reform (55% ‚Üí 20%)</span>
        <span class="data-value green">In 2026 Diet session</span>
      </div>
      <div class="data-row">
        <span class="data-label">SBI VC Trade XRP/JPY</span>
        <span class="data-value blue">Monitor for spikes</span>
      </div>
    </div>
  </div>

  <!-- ==================== XRPL INFRA ==================== -->
  <div class="tab-panel" id="panel-infra">
    <div class="countdown">
      <div class="countdown-label">PermissionedDEX Goes Live</div>
      <div class="countdown-value" id="pdexCountdown2">--d --h --m</div>
    </div>

    <div class="full-card">
      <h3>XRPL Amendments</h3>
      <div class="amendment-item">
        <span class="amend-status amend-live">LIVE</span>
        <span class="amend-name">Permissioned Domains</span>
        <span class="amend-detail">Feb 4</span>
      </div>
      <div class="amendment-item">
        <span class="amend-status amend-live">LIVE</span>
        <span class="amend-name">Multi-Purpose Tokens</span>
        <span class="amend-detail">Active</span>
      </div>
      <div class="amendment-item">
        <span class="amend-status amend-live">LIVE</span>
        <span class="amend-name">Credentials</span>
        <span class="amend-detail">Active</span>
      </div>
      <div class="amendment-item">
        <span class="amend-status amend-live">LIVE</span>
        <span class="amend-name">Deep Freeze</span>
        <span class="amend-detail">Active</span>
      </div>
      <div class="amendment-item">
        <span class="amend-status amend-live">LIVE</span>
        <span class="amend-name">Simulate</span>
        <span class="amend-detail">Active</span>
      </div>
      <div class="amendment-item">
        <span class="amend-status amend-soon">ACTIVATING</span>
        <span class="amend-name">PermissionedDEX (XLS-81)</span>
        <span class="amend-detail">~Feb 17-20</span>
      </div>
      <div class="amendment-item">
        <span class="amend-status amend-voting">76%</span>
        <span class="amend-name">Batch Transactions</span>
        <span class="amend-detail">Need 80%</span>
      </div>
      <div class="amendment-item">
        <span class="amend-status amend-voting">VOTING</span>
        <span class="amend-name">Token Escrow</span>
        <span class="amend-detail">In progress</span>
      </div>
      <div class="amendment-item">
        <span class="amend-status amend-voting">UPCOMING</span>
        <span class="amend-name">Lending Protocol (XLS-65/66)</span>
        <span class="amend-detail">Q2 2026</span>
      </div>
      <div class="amendment-item">
        <span class="amend-status amend-voting">UPCOMING</span>
        <span class="amend-name">Confidential Transfers</span>
        <span class="amend-detail">Q1 2026</span>
      </div>

      <div class="interpret-box">
        <div class="label">Infrastructure Reading</div>
        <p>Compliance stack nearly complete. <strong>Permissioned Domains + PermissionedDEX + Credentials + MPT = full institutional DeFi stack.</strong> Once Batch Transactions passes 80%, atomic DvP becomes possible ‚Äî critical for repo markets and institutional settlement. Highway being paved before the traffic arrives.</p>
      </div>
    </div>

    <div class="full-card">
      <h3>Ripple Corporate Stack</h3>
      <div class="data-row">
        <span class="data-label">Ripple Payments (ODL/ILP)</span>
        <span class="data-value green">Live ‚Äî 300+ institutions</span>
      </div>
      <div class="data-row">
        <span class="data-label">Ripple Custody (Metaco)</span>
        <span class="data-value green">Live</span>
      </div>
      <div class="data-row">
        <span class="data-label">Ripple Prime (Hidden Road)</span>
        <span class="data-value green">Live + Hyperliquid</span>
      </div>
      <div class="data-row">
        <span class="data-label">Ripple Treasury (GTreasury)</span>
        <span class="data-value green">Live</span>
      </div>
      <div class="data-row">
        <span class="data-label">RLUSD Stablecoin</span>
        <span class="data-value green">Live ‚Äî Binance listed</span>
      </div>
      <div class="data-row">
        <span class="data-label">DXC/Hogan Integration</span>
        <span class="data-value green">Announced Jan 21</span>
      </div>
      <div class="data-row">
        <span class="data-label">Global Licenses</span>
        <span class="data-value green">75+ (EU, UK, SG, JP...)</span>
      </div>
      <div class="data-row">
        <span class="data-label">Evernorth (XRP Treasury)</span>
        <span class="data-value blue">IPO Q1 + Lending Protocol</span>
      </div>
    </div>
  </div>

  <!-- ==================== THESIS SCORECARD ==================== -->
  <div class="tab-panel" id="panel-thesis">
    <div class="full-card">
      <h3>‚óé Thesis Validation Scorecard</h3>
      <p style="font-size:11px;color:var(--text-muted);margin-bottom:14px;">Green = validated. Amber = in progress. Red = not yet confirmed.</p>

      <div class="thesis-item">
        <div class="thesis-indicator green"></div>
        <div class="thesis-text">
          <h4>Infrastructure Pre-Deployment</h4>
          <p>Payments, Custody, Prime, Treasury, Stablecoin, DEX all operational or activating. Validated.</p>
        </div>
      </div>
      <div class="thesis-item">
        <div class="thesis-indicator green"></div>
        <div class="thesis-text">
          <h4>Japanese Institutional Positioning</h4>
          <p>SBI deep integration. FIEA reclassification Q2 target. Tax reform 55%‚Üí20%. $21.7B JPY into XRP vs $4.7B into BTC.</p>
        </div>
      </div>
      <div class="thesis-item">
        <div class="thesis-indicator green"></div>
        <div class="thesis-text">
          <h4>Regulatory Licensing</h4>
          <p>75+ licenses globally. More licensed than any crypto company. EU, UK, SG, JP.</p>
        </div>
      </div>
      <div class="thesis-item">
        <div class="thesis-indicator green"></div>
        <div class="thesis-text">
          <h4>ETF Divergence from BTC/ETH</h4>
          <p>Only crypto ETF with inflows during Feb 5 crash. 55-day consecutive streak. Structural.</p>
        </div>
      </div>
      <div class="thesis-item">
        <div class="thesis-indicator amber"></div>
        <div class="thesis-text">
          <h4>ODL Volume Acceleration</h4>
          <p>$15B in 2024, +32% YoY. Needs $20-30B+ in 2026. PRIMARY FALSIFICATION CRITERION. Post-pDEX is the test.</p>
        </div>
      </div>
      <div class="thesis-item">
        <div class="thesis-indicator amber"></div>
        <div class="thesis-text">
          <h4>Yen Carry Trade Unwind</h4>
          <p>Mechanism validated ‚Äî Japan bond crash happened. Catalyst was fiscal policy, not Hormuz. In progress.</p>
        </div>
      </div>
      <div class="thesis-item">
        <div class="thesis-indicator amber"></div>
        <div class="thesis-text">
          <h4>Hormuz / Oil Catalyst</h4>
          <p>Real tensions. Diplomatic tracks active. Friday Oman talks pivotal. Moderate probability.</p>
        </div>
      </div>
      <div class="thesis-item">
        <div class="thesis-indicator amber"></div>
        <div class="thesis-text">
          <h4>US Clarity Act</h4>
          <p>Pushed to Spring. SEC and CFTC moving independently. Direction right, timeline uncertain.</p>
        </div>
      </div>
      <div class="thesis-item">
        <div class="thesis-indicator red"></div>
        <div class="thesis-text">
          <h4>XRP Treated as Utility (Not Risk Asset)</h4>
          <p>Still bleeds with broader crypto. ETF flows diverge but price doesn't yet. Post-pDEX activation is the test.</p>
        </div>
      </div>
      <div class="thesis-item">
        <div class="thesis-indicator red"></div>
        <div class="thesis-text">
          <h4>Central Bank Deployment</h4>
          <p>No confirmed central bank using XRPL for production settlement. Patents ‚â† deployment. Biggest gap.</p>
        </div>
      </div>
    </div>

    <div class="full-card">
      <h3>Position Summary</h3>
      <div class="data-row">
        <span class="data-label">XRP Holdings</span>
        <span class="data-value">30,639 XRP</span>
      </div>
      <div class="data-row">
        <span class="data-label">Wallet Rank</span>
        <span class="data-value blue">Top 1.52%</span>
      </div>
      <div class="data-row">
        <span class="data-label">Current Value</span>
        <span class="data-value" id="positionValue">--</span>
      </div>
      <div class="data-row">
        <span class="data-label">Base ($5-15)</span>
        <span class="data-value green">$153K - $460K</span>
      </div>
      <div class="data-row">
        <span class="data-label">Mid ($20-50)</span>
        <span class="data-value green">$613K - $1.53M</span>
      </div>
      <div class="data-row">
        <span class="data-label">Bull ($100+)</span>
        <span class="data-value green">$3.06M+</span>
      </div>
      <div class="data-row">
        <span class="data-label">Leverage</span>
        <span class="data-value green">ZERO</span>
      </div>
      <div class="data-row">
        <span class="data-label">Risk to Livelihood</span>
        <span class="data-value green">NONE</span>
      </div>
    </div>
  </div>

  <!-- ==================== INTEL FEED ==================== -->
  <div class="tab-panel" id="panel-feed">
    <div class="interpret-box" style="margin-bottom:14px;">
      <div class="label">Intelligence Feed</div>
      <p>Your curated watchlist of decision-makers and infrastructure operators. Not influencers ‚Äî the people and institutions who will determine whether global finance goes on-chain. Tap any card to open their X feed.</p>
    </div>

    <div class="feed-category">
      <div class="feed-category-label">Global Institutions & Policy</div>
      <div class="feed-accounts">
        <a href="https://x.com/whitehouse" target="_blank" class="feed-account-card">
          <div class="feed-avatar">üèõÔ∏è</div>
          <div class="feed-account-info">
            <div class="feed-handle">@WhiteHouse</div>
            <div class="feed-desc">Executive orders, policy direction, stablecoin signals</div>
          </div>
          <span class="feed-tag policy">POLICY</span>
        </a>
        <a href="https://x.com/secscottbessent" target="_blank" class="feed-account-card">
          <div class="feed-avatar">üíµ</div>
          <div class="feed-account-info">
            <div class="feed-handle">@SecScottBessent</div>
            <div class="feed-desc">US Treasury Secretary ‚Äî fiscal policy, debt, digital assets</div>
          </div>
          <span class="feed-tag policy">POLICY</span>
        </a>
        <a href="https://x.com/lagarde" target="_blank" class="feed-account-card">
          <div class="feed-avatar">üá™üá∫</div>
          <div class="feed-account-info">
            <div class="feed-handle">@Lagarde</div>
            <div class="feed-desc">ECB President ‚Äî euro CBDC, monetary policy, digital euro</div>
          </div>
          <span class="feed-tag policy">POLICY</span>
        </a>
        <a href="https://x.com/kgeorgieva" target="_blank" class="feed-account-card">
          <div class="feed-avatar">üåê</div>
          <div class="feed-account-info">
            <div class="feed-handle">@KGeorgieva</div>
            <div class="feed-desc">IMF Managing Director ‚Äî global finance reform signals</div>
          </div>
          <span class="feed-tag policy">POLICY</span>
        </a>
        <a href="https://x.com/imfnews" target="_blank" class="feed-account-card">
          <div class="feed-avatar">üè¶</div>
          <div class="feed-account-info">
            <div class="feed-handle">@IMFNews</div>
            <div class="feed-desc">IMF ‚Äî SDR, cross-border payment reform, CBDC pilots</div>
          </div>
          <span class="feed-tag policy">POLICY</span>
        </a>
        <a href="https://x.com/bis_org" target="_blank" class="feed-account-card">
          <div class="feed-avatar">üèõÔ∏è</div>
          <div class="feed-account-info">
            <div class="feed-handle">@BIS_org</div>
            <div class="feed-desc">Bank for Intl Settlements ‚Äî mBridge, Project Agora, FX settlement</div>
          </div>
          <span class="feed-tag policy">POLICY</span>
        </a>
        <a href="https://x.com/carolinedpham" target="_blank" class="feed-account-card">
          <div class="feed-avatar">‚öñÔ∏è</div>
          <div class="feed-account-info">
            <div class="feed-handle">@CarolineDPham</div>
            <div class="feed-desc">CFTC Commissioner ‚Äî tokenization framework, crypto regulation</div>
          </div>
          <span class="feed-tag policy">POLICY</span>
        </a>
      </div>
    </div>

    <div class="feed-category">
      <div class="feed-category-label">Infrastructure Incumbents</div>
      <div class="feed-accounts">
        <a href="https://x.com/the_dtcc" target="_blank" class="feed-account-card">
          <div class="feed-avatar">üîó</div>
          <div class="feed-account-info">
            <div class="feed-handle">@The_DTCC</div>
            <div class="feed-desc">$2.5Q+ cleared annually ‚Äî tokenization pilots, settlement</div>
          </div>
          <span class="feed-tag infra">INFRA</span>
        </a>
        <a href="https://x.com/swiftcommunity" target="_blank" class="feed-account-card">
          <div class="feed-avatar">üåç</div>
          <div class="feed-account-info">
            <div class="feed-handle">@SWIFTCommunity</div>
            <div class="feed-desc">11,000+ institutions ‚Äî interop experiments, tokenized asset pilots</div>
          </div>
          <span class="feed-tag infra">INFRA</span>
        </a>
      </div>
    </div>

    <div class="feed-category">
      <div class="feed-category-label">Ripple & XRPL</div>
      <div class="feed-accounts">
        <a href="https://x.com/Ripple" target="_blank" class="feed-account-card">
          <div class="feed-avatar">üíß</div>
          <div class="feed-account-info">
            <div class="feed-handle">@Ripple</div>
            <div class="feed-desc">Official ‚Äî partnerships, licensing, product launches</div>
          </div>
          <span class="feed-tag infra">INFRA</span>
        </a>
        <a href="https://x.com/ripplexdev" target="_blank" class="feed-account-card">
          <div class="feed-avatar">‚öôÔ∏è</div>
          <div class="feed-account-info">
            <div class="feed-handle">@RippleXDev</div>
            <div class="feed-desc">XRPL development ‚Äî amendments, SDKs, technical updates</div>
          </div>
          <span class="feed-tag infra">INFRA</span>
        </a>
      </div>
    </div>

    <div class="feed-category">
      <div class="feed-category-label">Macro, OSINT & News</div>
      <div class="feed-accounts">
        <a href="https://x.com/kobeissiletter" target="_blank" class="feed-account-card">
          <div class="feed-avatar">üìä</div>
          <div class="feed-account-info">
            <div class="feed-handle">@KobeissiLetter</div>
            <div class="feed-desc">Macro analysis ‚Äî yields, FX, central bank moves, risk events</div>
          </div>
          <span class="feed-tag macro">MACRO</span>
        </a>
        <a href="https://x.com/marionawfal" target="_blank" class="feed-account-card">
          <div class="feed-avatar">üåê</div>
          <div class="feed-account-info">
            <div class="feed-handle">@MarioNawfal</div>
            <div class="feed-desc">Breaking news aggregator ‚Äî geopolitical, finance, tech</div>
          </div>
          <span class="feed-tag news">NEWS</span>
        </a>
        <a href="https://x.com/osint613" target="_blank" class="feed-account-card">
          <div class="feed-avatar">üîç</div>
          <div class="feed-account-info">
            <div class="feed-handle">@OSINT613</div>
            <div class="feed-desc">Open source intelligence ‚Äî Middle East, military, Hormuz</div>
          </div>
          <span class="feed-tag macro">OSINT</span>
        </a>
        <a href="https://x.com/eleanorterrett" target="_blank" class="feed-account-card">
          <div class="feed-avatar">üì∞</div>
          <div class="feed-account-info">
            <div class="feed-handle">@EleanorTerrett</div>
            <div class="feed-desc">Fox Business ‚Äî SEC, crypto regulation, ETF filings</div>
          </div>
          <span class="feed-tag news">NEWS</span>
        </a>
        <a href="https://x.com/ericldaugh" target="_blank" class="feed-account-card">
          <div class="feed-avatar">üì∞</div>
          <div class="feed-account-info">
            <div class="feed-handle">@EricLDaugh</div>
            <div class="feed-desc">Breaking news ‚Äî politics, policy, institutional moves</div>
          </div>
          <span class="feed-tag news">NEWS</span>
        </a>
        <a href="https://x.com/coindesk" target="_blank" class="feed-account-card">
          <div class="feed-avatar">üì∞</div>
          <div class="feed-account-info">
            <div class="feed-handle">@CoinDesk</div>
            <div class="feed-desc">Crypto news ‚Äî market moves, regulatory, institutional</div>
          </div>
          <span class="feed-tag news">NEWS</span>
        </a>
        <a href="https://x.com/whale_alert" target="_blank" class="feed-account-card">
          <div class="feed-avatar">üêã</div>
          <div class="feed-account-info">
            <div class="feed-handle">@whale_alert</div>
            <div class="feed-desc">Large transaction tracking ‚Äî whale moves, exchange flows</div>
          </div>
          <span class="feed-tag macro">CHAIN</span>
        </a>
      </div>
    </div>
  </div>

  <!-- ==================== ODL GUIDE ==================== -->
  <div class="tab-panel" id="panel-odlguide">
    <div class="interpret-box" style="margin-bottom:14px;">
      <div class="label">Why This Matters</div>
      <p>ODL volume is your <strong>primary falsification criterion</strong>. If you can read this data yourself in 30 seconds, you don't need anyone to interpret it for you. This guide teaches you to read Utility-Scan and XRPScan like a fire scene ‚Äî structure, smoke, risk, exit.</p>
    </div>

    <div class="guide-step">
      <div class="guide-step-num">Step 1 ‚Äî What is ODL?</div>
      <h4>On-Demand Liquidity in Plain English</h4>
      <p>A bank in Mexico wants to send $1M to a bank in the Philippines. Old way: 3-5 days, correspondent banks, nostro/vostro accounts, fees everywhere.</p>
      <p>ODL way: Source currency ‚Üí buy XRP ‚Üí 3-second transfer ‚Üí sell XRP ‚Üí destination currency. XRP is the bridge asset. It's bought and sold within seconds ‚Äî the sending institution never "holds" XRP.</p>
      <p>Every ODL transaction creates <strong>real buy pressure</strong> on one exchange and <strong>real sell pressure</strong> on another. At volume, this creates sustained demand for XRP as a utility asset, not a speculative one. That's the entire thesis mechanism.</p>
    </div>

    <div class="guide-step">
      <div class="guide-step-num">Step 2 ‚Äî Reading Utility-Scan</div>
      <h4>What You're Looking At</h4>
      <p>Go to <strong>utility-scan.com</strong>. The main view shows ODL payment flows between corridors (country pairs). Here's how to read it:</p>

      <div class="guide-metric">
        <span class="gm-label">Corridor Pair (e.g. USD‚ÜíMXN)</span>
        <span class="gm-value">Source ‚Üí Destination</span>
      </div>
      <div class="guide-metric">
        <span class="gm-label">Volume (24h)</span>
        <span class="gm-value green">Higher = more institutional use</span>
      </div>
      <div class="guide-metric">
        <span class="gm-label"># of Payments</span>
        <span class="gm-value">Transaction count, not $ value</span>
      </div>
      <div class="guide-metric">
        <span class="gm-label">Avg Payment Size</span>
        <span class="gm-value amber">Larger = more institutional</span>
      </div>

      <div class="guide-callout">
        <p><strong>Key signal:</strong> Rising average payment size + rising payment count = institutional adoption scaling. If count rises but avg size drops, it's retail. If avg size rises dramatically, a new institutional corridor opened.</p>
      </div>
    </div>

    <div class="guide-step">
      <div class="guide-step-num">Step 3 ‚Äî Corridors That Matter</div>
      <h4>Where to Focus Your Eyes</h4>
      <p>Not all corridors are equal. These are the ones that move the thesis needle:</p>

      <div class="guide-metric">
        <span class="gm-label">USD ‚Üí MXN (US ‚Üí Mexico)</span>
        <span class="gm-value green">Largest ODL corridor</span>
      </div>
      <div class="guide-metric">
        <span class="gm-label">USD ‚Üí PHP (US ‚Üí Philippines)</span>
        <span class="gm-value green">Remittance powerhouse</span>
      </div>
      <div class="guide-metric">
        <span class="gm-label">JPY pairs (Japan ‚Üí anywhere)</span>
        <span class="gm-value amber">SBI integration indicator</span>
      </div>
      <div class="guide-metric">
        <span class="gm-label">EUR pairs (post-EMI license)</span>
        <span class="gm-value amber">Watch for new corridors</span>
      </div>
      <div class="guide-metric">
        <span class="gm-label">SGD pairs (post-MPI expansion)</span>
        <span class="gm-value amber">APAC expansion signal</span>
      </div>

      <div class="guide-callout">
        <p><strong>Thesis validation:</strong> If you see NEW corridor pairs appearing (especially EUR or GBP corridors post-licensing), that's infrastructure going live. If existing corridors show volume spikes during geopolitical stress, that's your "stress drives adoption" thesis confirming.</p>
      </div>
    </div>

    <div class="guide-step">
      <div class="guide-step-num">Step 4 ‚Äî ODL vs. Regular XRP Transactions</div>
      <h4>Separating Signal from Noise</h4>
      <p>Not every XRP transaction is ODL. Most are speculative trading. Here's how to tell them apart:</p>

      <div class="guide-metric">
        <span class="gm-label">ODL Transactions</span>
        <span class="gm-value green">Fixed corridors, consistent sizes, institutional timing</span>
      </div>
      <div class="guide-metric">
        <span class="gm-label">Speculative Transactions</span>
        <span class="gm-value red">Random sizes, exchange-to-exchange, retail patterns</span>
      </div>

      <p>Utility-Scan filters for ODL-specific patterns. XRPScan shows ALL transactions. The gap between total XRPL volume and ODL volume tells you what percentage of XRP activity is utility vs. speculation. <strong>Your thesis wins when utility overtakes speculation.</strong></p>
    </div>

    <div class="guide-step">
      <div class="guide-step-num">Step 5 ‚Äî The Numbers That Matter</div>
      <h4>Your 30-Second Daily Check</h4>
      <p>Every morning, check these three things. Takes 30 seconds:</p>

      <div class="guide-metric">
        <span class="gm-label">1. Utility-Scan 24h volume</span>
        <span class="gm-value">Trending up or down?</span>
      </div>
      <div class="guide-metric">
        <span class="gm-label">2. New corridors appearing?</span>
        <span class="gm-value">Infrastructure expansion signal</span>
      </div>
      <div class="guide-metric">
        <span class="gm-label">3. Avg payment size trend</span>
        <span class="gm-value">Institutional vs. retail indicator</span>
      </div>

      <div class="guide-warning">
        <p><strong>Red flag:</strong> If PermissionedDEX goes live (~Feb 20) and ODL volume stays flat for 30+ days, that's a warning sign. If geopolitical stress spikes and ODL doesn't respond, your stress-adoption thesis needs revision.</p>
      </div>
    </div>

    <div class="guide-step">
      <div class="guide-step-num">Step 6 ‚Äî Reading XRPScan Metrics</div>
      <h4>On-Chain Health Indicators</h4>
      <p>Go to <strong>xrpscan.com/metrics</strong>. Key numbers to watch:</p>

      <div class="guide-metric">
        <span class="gm-label">Daily Transactions</span>
        <span class="gm-value">Network usage (currently ~1.8M/day)</span>
      </div>
      <div class="guide-metric">
        <span class="gm-label">Active Addresses</span>
        <span class="gm-value">Unique wallets interacting (growing = good)</span>
      </div>
      <div class="guide-metric">
        <span class="gm-label">DEX Volume</span>
        <span class="gm-value amber">Currently tiny ‚Äî pDEX changes this</span>
      </div>
      <div class="guide-metric">
        <span class="gm-label">Escrow Releases</span>
        <span class="gm-value">Ripple's monthly unlock ‚Äî watch if returned to escrow or sold</span>
      </div>

      <p><strong>Think of it like a building inspection.</strong> Transactions = foot traffic. Active addresses = unique tenants. DEX volume = commerce activity. Escrow = how the developer is managing supply. You want rising traffic, growing tenants, increasing commerce, and disciplined supply management.</p>
    </div>

    <div class="guide-step">
      <div class="guide-step-num">Step 7 ‚Äî Post-PermissionedDEX Signals</div>
      <h4>What Changes After ~Feb 20</h4>
      <p>Once PermissionedDEX goes live, the game changes. Here's what to watch for:</p>

      <div class="guide-metric">
        <span class="gm-label">pDEX trading volume appearing</span>
        <span class="gm-value green">Institutions using KYC-gated DEX</span>
      </div>
      <div class="guide-metric">
        <span class="gm-label">New token pairs on pDEX</span>
        <span class="gm-value green">Tokenized assets being traded</span>
      </div>
      <div class="guide-metric">
        <span class="gm-label">ODL corridor volume spike</span>
        <span class="gm-value green">pDEX improving settlement efficiency</span>
      </div>
      <div class="guide-metric">
        <span class="gm-label">Flat volume post-activation</span>
        <span class="gm-value red">Infrastructure built but nobody came</span>
      </div>

      <div class="guide-callout">
        <p><strong>The first 30 days post-pDEX are your most important monitoring window of 2026.</strong> This is where thesis meets reality. Infrastructure is deploying ‚Äî the question is whether demand follows. Treat it like a fire scene: read the smoke, don't assume the outcome.</p>
      </div>
    </div>

    <div class="section-header">Quick Access</div>
    <div class="quick-links">
      <a href="https://utility-scan.com" target="_blank" class="quick-link">
        <span class="link-icon">üì°</span>Utility-Scan
      </a>
      <a href="https://xrpscan.com/metrics" target="_blank" class="quick-link">
        <span class="link-icon">üîç</span>XRPScan Metrics
      </a>
      <a href="https://threexrp.dev" target="_blank" class="quick-link">
        <span class="link-icon">üìä</span>ThreeXRP
      </a>
      <a href="https://livenet.xrpl.org" target="_blank" class="quick-link">
        <span class="link-icon">‚õì</span>XRPL Explorer
      </a>
    </div>
  </div>

  <!-- ==================== LINKS ==================== -->
  <div class="tab-panel" id="panel-links">
    <div class="section-header">ODL & On-Chain</div>
    <div class="quick-links">
      <a href="https://utility-scan.com" target="_blank" class="quick-link"><span class="link-icon">üì°</span>Utility-Scan</a>
      <a href="https://xrpscan.com/metrics" target="_blank" class="quick-link"><span class="link-icon">üîç</span>XRPScan</a>
      <a href="https://threexrp.dev" target="_blank" class="quick-link"><span class="link-icon">üìä</span>ThreeXRP</a>
      <a href="https://livenet.xrpl.org" target="_blank" class="quick-link"><span class="link-icon">‚õì</span>XRPL Explorer</a>
    </div>

    <div class="section-header">ETF Tracking</div>
    <div class="quick-links">
      <a href="https://xpmarket.com/etf" target="_blank" class="quick-link"><span class="link-icon">üìà</span>XPMarket ETF</a>
      <a href="https://xrp-insights.com" target="_blank" class="quick-link"><span class="link-icon">üîé</span>XRP Insights</a>
      <a href="https://www.coinglass.com/xrp-etf" target="_blank" class="quick-link"><span class="link-icon">üìä</span>CoinGlass ETF</a>
      <a href="https://www.sosvalue.com" target="_blank" class="quick-link"><span class="link-icon">üí∞</span>SoSoValue</a>
    </div>

    <div class="section-header">Macro & Geopolitical</div>
    <div class="quick-links">
      <a href="https://tradingeconomics.com/japan/government-bond-yield" target="_blank" class="quick-link"><span class="link-icon">üáØüáµ</span>Japan Yields</a>
      <a href="https://www.criticalthreats.org" target="_blank" class="quick-link"><span class="link-icon">üî¥</span>Iran Updates</a>
      <a href="https://www.iranintl.com/en" target="_blank" class="quick-link"><span class="link-icon">üì∞</span>Iran Intl</a>
      <a href="https://alternative.me/crypto/fear-and-greed-index/" target="_blank" class="quick-link"><span class="link-icon">üò±</span>Fear & Greed</a>
    </div>

    <div class="section-header">Ripple Official</div>
    <div class="quick-links">
      <a href="https://ripple.com/insights" target="_blank" class="quick-link"><span class="link-icon">üí°</span>Ripple Blog</a>
      <a href="https://ripple.com/press-releases" target="_blank" class="quick-link"><span class="link-icon">üì¢</span>Ripple Press</a>
      <a href="https://xrpl.org/docs" target="_blank" class="quick-link"><span class="link-icon">üìñ</span>XRPL Docs</a>
      <a href="https://xrpl.org/resources/known-amendments" target="_blank" class="quick-link"><span class="link-icon">‚öôÔ∏è</span>Amendments</a>
    </div>

    <div class="section-header">Price & Market</div>
    <div class="quick-links">
      <a href="https://www.coingecko.com/en/coins/xrp" target="_blank" class="quick-link"><span class="link-icon">ü¶é</span>CoinGecko</a>
      <a href="https://www.coindesk.com/price/xrp" target="_blank" class="quick-link"><span class="link-icon">üì∞</span>CoinDesk</a>
      <a href="https://www.livecoinwatch.com/price/XRP-XRP" target="_blank" class="quick-link"><span class="link-icon">üëÅ</span>LiveCoinWatch</a>
      <a href="https://cryptoslate.com" target="_blank" class="quick-link"><span class="link-icon">üìã</span>CryptoSlate</a>
    </div>
  </div>

</div>

<!-- ===== POSITION DOCK ===== -->
<div class="position-dock">
  <div>
    <div class="pos-label">30,639 XRP</div>
    <div class="pos-xrp">Top 1.52% | Zero Leverage</div>
  </div>
  <div style="text-align:right;">
    <div class="pos-value" id="dockValue">--</div>
    <div class="pos-xrp">Current Value</div>
  </div>
</div>

<!-- ===== SCRIPTS ===== -->
<script>
// ===== TAB SWITCHING =====
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById('panel-' + btn.dataset.tab).classList.add('active');
    window.scrollTo(0, 0);
  });
});

// ===== COUNTDOWN =====
function updateCountdown() {
  const target = new Date('2026-02-18T00:00:00Z');
  const now = new Date();
  const diff = target - now;

  if (diff <= 0) {
    document.getElementById('pdexCountdown').textContent = 'üü¢ LIVE';
    const el2 = document.getElementById('pdexCountdown2');
    if (el2) el2.textContent = 'üü¢ LIVE';
    return;
  }

  const d = Math.floor(diff / 86400000);
  const h = Math.floor((diff % 86400000) / 3600000);
  const m = Math.floor((diff % 3600000) / 60000);
  const text = `${d}d ${h}h ${m}m`;

  document.getElementById('pdexCountdown').textContent = text;
  const el2 = document.getElementById('pdexCountdown2');
  if (el2) el2.textContent = text;
}

updateCountdown();
setInterval(updateCountdown, 60000);

// ===== XRP PRICE (Multiple Sources with Fallback) =====
async function fetchXRPPrice() {
  let price = null, change = null, vol = null, mcap = null;

  // Source 1: CoinCap (most reliable, CORS-friendly)
  try {
    const resp = await fetch('https://api.coincap.io/v2/assets/xrp');
    const data = await resp.json();
    if (data.data) {
      price = parseFloat(data.data.priceUsd);
      change = parseFloat(data.data.changePercent24Hr);
      vol = parseFloat(data.data.volumeUsd24Hr);
      mcap = parseFloat(data.data.marketCapUsd);
    }
  } catch(e) { console.log('CoinCap failed'); }

  // Source 2: Binance
  if (!price) {
    try {
      const resp = await fetch('https://api.binance.com/api/v3/ticker/24hr?symbol=XRPUSDT');
      const data = await resp.json();
      if (data.lastPrice) {
        price = parseFloat(data.lastPrice);
        change = parseFloat(data.priceChangePercent);
        vol = parseFloat(data.quoteVolume);
      }
    } catch(e) { console.log('Binance failed'); }
  }

  // Source 3: CoinGecko
  if (!price) {
    try {
      const resp = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=ripple&vs_currencies=usd&include_24hr_change=true&include_24hr_vol=true&include_market_cap=true');
      const data = await resp.json();
      if (data.ripple) {
        price = data.ripple.usd;
        change = data.ripple.usd_24h_change;
        vol = data.ripple.usd_24h_vol;
        mcap = data.ripple.usd_market_cap;
      }
    } catch(e) { console.log('CoinGecko failed'); }
  }

  if (price) {
    document.getElementById('xrpPrice').textContent = '$' + price.toFixed(4);
    const changeEl = document.getElementById('xrpChange');
    if (change !== null) {
      changeEl.textContent = (change >= 0 ? '+' : '') + parseFloat(change).toFixed(2) + '%';
      changeEl.className = 'ticker-change ' + (change >= 0 ? 'positive' : 'negative');
    }
    if (vol) document.getElementById('xrpVol').textContent = '$' + (vol / 1e9).toFixed(2) + 'B';
    if (mcap) document.getElementById('xrpMcap').textContent = '$' + (mcap / 1e9).toFixed(1) + 'B';
    const posValue = (30639 * price).toLocaleString(undefined, { maximumFractionDigits: 0 });
    document.getElementById('positionValue').textContent = '$' + posValue;
    document.getElementById('dockValue').textContent = '$' + posValue;
    document.getElementById('lastUpdated').innerHTML = '<span class="live-dot"></span>' + new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
  } else {
    document.getElementById('xrpPrice').textContent = 'OFFLINE';
    document.getElementById('xrpPrice').style.color = 'var(--accent-red)';
  }
}

// ===== MACRO DATA (USD/JPY, Oil, BTC, ETH) =====
async function fetchMacroData() {
  // USD/JPY via Frankfurter (free, no key, no CORS issues)
  try {
    const resp = await fetch('https://api.frankfurter.dev/v1/latest?base=USD&symbols=JPY');
    const data = await resp.json();
    if (data.rates && data.rates.JPY) {
      const rate = data.rates.JPY;
      const setJpy = (id) => { const el = document.getElementById(id); if (el) el.textContent = '¬•' + rate.toFixed(2); };
      setJpy('usdJpy');
      setJpy('macroJpy');
    }
  } catch(e) { console.log('JPY fetch failed'); }

  // Oil via CoinCap commodities or fallback
  try {
    // Using Binance for oil proxy ‚Äî crude oil ETF (not perfect but free)
    // Better: use a dedicated commodities API if available
    const oilEl = document.getElementById('oilPrice');
    const macroOilEl = document.getElementById('macroOil');
    // We'll set these from the morning briefing for now
    // Static fallback with note
    if (oilEl && oilEl.textContent === '--') oilEl.textContent = 'See Brief';
    if (macroOilEl && macroOilEl.textContent === '--') macroOilEl.textContent = 'See Brief';
  } catch(e) {}

  // BTC + ETH for context (via CoinCap)
  try {
    const [btcResp, ethResp] = await Promise.all([
      fetch('https://api.coincap.io/v2/assets/bitcoin'),
      fetch('https://api.coincap.io/v2/assets/ethereum')
    ]);
    const btcData = await btcResp.json();
    const ethData = await ethResp.json();
    // Store for reference ‚Äî could display in macro tab
  } catch(e) {}
}

// ===== XRPL WEBSOCKET (LIVE ON-CHAIN DATA) =====
let xrplWs = null;
let reconnectAttempts = 0;
const XRPL_NODES = [
  'wss://xrplcluster.com',
  'wss://s1.ripple.com',
  'wss://s2.ripple.com'
];

function connectXRPL() {
  const nodeUrl = XRPL_NODES[reconnectAttempts % XRPL_NODES.length];
  
  try {
    xrplWs = new WebSocket(nodeUrl);
  } catch(e) {
    updateWsStatus('error', 'Connection failed');
    return;
  }

  xrplWs.onopen = function() {
    reconnectAttempts = 0;
    updateWsStatus('live', 'Connected to ' + nodeUrl.replace('wss://',''));

    // Subscribe to ledger closes
    xrplWs.send(JSON.stringify({
      "command": "subscribe",
      "streams": ["ledger"]
    }));

    // Get current server state
    xrplWs.send(JSON.stringify({
      "command": "server_state",
      "id": "server_state_1"
    }));
  };

  xrplWs.onmessage = function(event) {
    try {
      const data = JSON.parse(event.data);

      // Handle ledger close events (real-time)
      if (data.type === 'ledgerClosed') {
        updateLedgerData({
          ledger_index: data.ledger_index,
          txn_count: data.txn_count,
          ledger_time: data.ledger_time,
          fee_base: data.fee_base,
          validated_ledgers: data.validated_ledgers
        });
      }

      // Handle subscribe response (initial data)
      if (data.result && data.result.ledger_index) {
        updateLedgerData({
          ledger_index: data.result.ledger_index,
          txn_count: data.result.txn_count || '--',
          fee_base: data.result.fee_base,
          validated_ledgers: data.result.validated_ledgers
        });
      }

      // Handle server_state response
      if (data.result && data.result.state) {
        const state = data.result.state;
        if (state.validated_ledger) {
          const totalDrops = parseInt(state.validated_ledger.reserve_base || 0);
        }
        // Calculate XRP destroyed from state
        if (state.state_accounting) {
          // Server state received
        }
      }

      // Handle server_info style response for XRP supply
      if (data.result && data.result.info) {
        const info = data.result.info;
        if (info.validated_ledger) {
          const el = document.getElementById('validatedRange');
          if (el && info.complete_ledgers) el.textContent = info.complete_ledgers;
        }
      }

    } catch(e) {
      console.error('XRPL parse error:', e);
    }
  };

  xrplWs.onclose = function() {
    updateWsStatus('closed', 'Disconnected');
    reconnectAttempts++;
    if (reconnectAttempts < 15) {
      setTimeout(connectXRPL, Math.min(reconnectAttempts * 2000, 30000));
    }
  };

  xrplWs.onerror = function() {
    updateWsStatus('error', 'Error');
  };
}

function updateWsStatus(status, text) {
  const el = document.getElementById('wsStatus');
  if (!el) return;
  if (status === 'live') {
    el.innerHTML = '<span class="live-dot"></span>' + text;
    el.className = 'data-value green';
  } else if (status === 'error' || status === 'closed') {
    el.textContent = '‚ö† ' + text;
    el.className = 'data-value red';
  } else {
    el.textContent = text;
    el.className = 'data-value';
  }
}

function updateLedgerData(data) {
  // Briefing tab - detailed
  const setEl = (id, val) => { const el = document.getElementById(id); if (el && val !== undefined) el.textContent = val; };

  if (data.ledger_index) {
    setEl('latestLedger', '#' + data.ledger_index.toLocaleString());
    setEl('summaryLedger', '#' + data.ledger_index.toLocaleString());
  }

  if (data.txn_count !== undefined) {
    setEl('ledgerTxns', data.txn_count.toLocaleString());
    setEl('summaryTxns', data.txn_count.toLocaleString());
  }

  if (data.ledger_time) {
    // XRPL epoch starts Jan 1, 2000
    const xrplEpoch = 946684800;
    const date = new Date((data.ledger_time + xrplEpoch) * 1000);
    setEl('ledgerTime', date.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit',second:'2-digit'}));
  }

  if (data.fee_base) {
    setEl('baseFee', (data.fee_base / 1000000).toFixed(6) + ' XRP');
  }

  if (data.validated_ledgers) {
    setEl('validatedRange', data.validated_ledgers);
  }
}

// Fetch XRP supply data via JSON-RPC
async function fetchXRPSupply() {
  try {
    const resp = await fetch('https://s1.ripple.com:51234/', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        method: 'server_state',
        params: [{}]
      })
    });
    const data = await resp.json();

    if (data.result && data.result.state && data.result.state.validated_ledger) {
      const totalCoins = parseInt(data.result.state.validated_ledger.total_coins);
      const totalXrp = totalCoins / 1000000;
      const destroyed = 100000000000 - totalXrp;

      const setEl = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };

      setEl('totalXrp', (totalXrp / 1e9).toFixed(4) + 'B XRP');
      setEl('xrpDestroyed', destroyed.toLocaleString(undefined, {maximumFractionDigits: 0}) + ' XRP');
      setEl('summaryBurned', destroyed.toLocaleString(undefined, {maximumFractionDigits: 0}) + ' XRP');
      setEl('baseFee', (parseInt(data.result.state.validated_ledger.reserve_base) / 1000000) + ' XRP reserve');
    }
  } catch(e) {
    console.error('Supply fetch error:', e);
    // Try alternate endpoint
    try {
      const resp2 = await fetch('https://xrplcluster.com/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          method: 'server_state',
          params: [{}]
        })
      });
      const data2 = await resp2.json();
      if (data2.result && data2.result.state && data2.result.state.validated_ledger) {
        const totalCoins = parseInt(data2.result.state.validated_ledger.total_coins);
        const totalXrp = totalCoins / 1000000;
        const destroyed = 100000000000 - totalXrp;
        const setEl = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
        setEl('totalXrp', (totalXrp / 1e9).toFixed(4) + 'B XRP');
        setEl('xrpDestroyed', destroyed.toLocaleString(undefined, {maximumFractionDigits: 0}) + ' XRP');
        setEl('summaryBurned', destroyed.toLocaleString(undefined, {maximumFractionDigits: 0}) + ' XRP');
      }
    } catch(e2) {
      console.error('Supply fallback error:', e2);
    }
  }
}

// ===== TELEGRAM BRIEFING LOADER =====
const TG_BOT_TOKEN = '8515473712:...
const TG_CHAT_ID = '7698951410';

async function fetchLatestBriefing() {
  try {
    const resp = await fetch(`https://api.telegram.org/bot${TG_BOT_TOKEN}/getUpdates?offset=-5&limit=5`);
    const data = await resp.json();

    if (data.ok && data.result && data.result.length > 0) {
      // Find the latest message from the bot (not from user)
      let latestBriefing = null;
      for (let i = data.result.length - 1; i >= 0; i--) {
        const msg = data.result[i].message || data.result[i].channel_post;
        if (msg && msg.text && msg.text.includes('OVERWATCH')) {
          latestBriefing = msg;
          break;
        }
      }

      if (latestBriefing) {
        displayBriefing(latestBriefing.text, new Date(latestBriefing.date * 1000));
        return;
      }
    }

    // If no briefing found via API, check localStorage
    const saved = localStorage.getItem('overwatch_briefing');
    if (saved) {
      const parsed = JSON.parse(saved);
      displayBriefing(parsed.text, new Date(parsed.time));
    }
  } catch(e) {
    console.error('Briefing fetch error:', e);
    // Fall back to localStorage
    const saved = localStorage.getItem('overwatch_briefing');
    if (saved) {
      const parsed = JSON.parse(saved);
      displayBriefing(parsed.text, new Date(parsed.time));
    }
  }
}

function displayBriefing(text, time) {
  const el = document.getElementById('briefingContent');
  if (!el) return;

  // Clean up Telegram HTML tags and format for display
  let cleaned = text
    .replace(/<b>/g, '<strong>').replace(/<\/b>/g, '</strong>')
    .replace(/<i>/g, '<em>').replace(/<\/i>/g, '</em>')
    .replace(/\n/g, '<br>');

  el.innerHTML = cleaned;

  const timeEl = document.getElementById('briefingTime');
  if (timeEl && time) {
    timeEl.textContent = time.toLocaleString([], {month:'short', day:'numeric', hour:'2-digit', minute:'2-digit'});
  }

  // Cache it
  try {
    localStorage.setItem('overwatch_briefing', JSON.stringify({ text: text, time: time.getTime() }));
  } catch(e) {}
}

function loadManualBriefing() {
  const input = document.getElementById('briefingInput');
  if (input && input.value.trim()) {
    displayBriefing(input.value.trim(), new Date());
    input.value = '';
  }
}

// ===== REFRESH ALL =====
function refreshAll() {
  fetchXRPPrice();
  fetchMacroData();
  updateCountdown();
  fetchXRPSupply();
  fetchLatestBriefing();
  if (!xrplWs || xrplWs.readyState > 1) {
    reconnectAttempts = 0;
    connectXRPL();
  }
}

// ===== INIT =====
fetchXRPPrice();
fetchMacroData();
setInterval(fetchXRPPrice, 120000);
setInterval(fetchMacroData, 300000); // Every 5 min

// Connect to XRPL
connectXRPL();

// Fetch supply data
fetchXRPSupply();
setInterval(fetchXRPSupply, 300000); // Every 5 min

// Load briefing
fetchLatestBriefing();
setInterval(fetchLatestBriefing, 600000); // Check every 10 min
</script>

</body>
</html>
